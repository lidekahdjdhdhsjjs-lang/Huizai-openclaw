{
  "generatedAt": "2026-02-24T00:07:27.646Z",
  "hooks": [
    {
      "name": "web-fetch-fallback",
      "dir": "/home/li/.openclaw/hooks/web-fetch-fallback",
      "files": {
        "handler.js": "/**\n * Web Fetch Fallback Hook\n * 当 web_fetch 失败时，尝试备用方案\n * \n * 策略:\n * 1. 重试 (最多3次，指数退避)\n * 2. 使用 web_search 替代\n * 3. 使用 browser 访问\n */\n\nmodule.exports = {\n  name: 'web-fetch-fallback',\n  events: ['tool_error'],\n  \n  handler: async (ctx) => {\n    const { tool, error, args, retry } = ctx;\n    \n    if (tool !== 'web_fetch') return ctx;\n    \n    const errorStr = String(error).toLowerCase();\n    console.log('[web-fetch-fallback] Error:', errorStr.slice(0, 100));\n    \n    // 策略1: 重试 (带退避)\n    if (!retry || retry.count < 3) {\n      const delay = Math.pow(2, (retry?.count || 0)) * 1000;\n      console.log('[web-fetch-fallback] Retrying in', delay, 'ms');\n      await new Promise(r => setTimeout(r, delay));\n      return { ...ctx, retry: { count: (retry?.count || 0) + 1, action: 'retry' } };\n    }\n    \n    // 策略2: 使用 web_search 替代\n    if (args?.url) {\n      console.log('[web-fetch-fallback] Fallback to web_search');\n      return { \n        ...ctx, \n        fallback: { \n          tool: 'web_search', \n          args: { query: args.url }\n        }\n      };\n    }\n    \n    // 策略3: 使用 browser 访问\n    console.log('[web-fetch-fallback] Fallback to browser');\n    return { \n      ...ctx, \n      fallback: { \n        tool: 'browser', \n        args: { action: 'navigate', url: args?.url }\n      }\n    };\n  }\n};\n",
        "HOOK.md": "---\nname: web-fetch-fallback\ndescription: web_fetch失败时的自动降级处理\nmetadata:\n  openclaw:\n    events: [\"tool_error\"]\n    priority: high\n---\n\n# Web Fetch Fallback\n\n当 web_fetch 工具失败时，自动尝试备用方案。\n\n## 策略\n1. **重试**: 最多3次，指数退避 (1s, 2s, 4s)\n2. **Web Search**: 使用搜索替代直接抓取\n3. **Browser**: 使用浏览器渲染页面\n\n## 触发条件\n- 工具: `web_fetch`\n- 错误: 任何错误\n\n## 效果\n预期将 web_fetch 健康度从 61% 提升到 85%+\n"
      }
    },
    {
      "name": "message-auto-retry",
      "dir": "/home/li/.openclaw/hooks/message-auto-retry",
      "files": {
        "handler.js": "/**\n * Message Auto-Retry Hook\n * 自动重试失败的消息发送\n * \n * 常见错误: gateway closed, unauthorized, timeout\n */\n\nmodule.exports = {\n  name: 'message-auto-retry',\n  events: ['tool_error'],\n  \n  handler: async (ctx) => {\n    const { tool, error } = ctx;\n    \n    if (tool !== 'message') return ctx;\n    \n    const errorStr = String(error).toLowerCase();\n    \n    // Gateway closed - 需要重连\n    if (errorStr.includes('gateway closed') || errorStr.includes('unauthorized')) {\n      console.log('[message-auto-retry] Gateway issue, may need reconnect');\n      return { \n        ...ctx, \n        action: 'reconnect',\n        retry: { count: 1, action: 'retry' }\n      };\n    }\n    \n    // Timeout - 直接重试\n    if (errorStr.includes('timeout')) {\n      console.log('[message-auto-retry] Timeout, retrying...');\n      return { ...ctx, retry: { count: 1, action: 'retry' } };\n    }\n    \n    return ctx;\n  }\n};\n",
        "HOOK.md": "---\nname: message-auto-retry\ndescription: 消息发送失败时的自动重试\nmetadata:\n  openclaw:\n    events: [\"tool_error\"]\n---\n\n# Message Auto-Retry\n\n自动处理 message 工具的常见错误。\n\n## 处理的错误\n- Gateway closed / unauthorized → 重连\n- Timeout → 重试\n- 其他错误 → 记录日志\n"
      }
    },
    {
      "name": "auto-fix-exec-mlzujdem",
      "dir": "/home/li/.openclaw/hooks/auto-fix-exec-mlzujdem",
      "files": {
        "handler.js": "/**\n * Auto-generated Hook: auto-fix-exec-mlzujdem\n * Pattern: error: missing required argument '...'\n\nUsage: clawhub search [options] <query...>\n\nVector search \n * Occurrences: 13\n * Generated: 2026-02-24T00:07:27.646Z\n */\n\nmodule.exports = {\n  name: 'auto-fix-exec-mlzujdem',\n  events: ['tool_error'],\n  \n  handler: async (ctx) => {\n    const { tool, error } = ctx;\n    \n    // 检查是否匹配模式\n    if (tool !== 'exec') return ctx;\n    \n    const errorStr = String(error).toLowerCase();\n    const pattern = 'error: missing required argument '...'\n\nusage: clawhub search [options] <query...>\n\nvector search ';\n    \n    if (!errorStr.includes(pattern.slice(0, 50).toLowerCase())) {\n      return ctx;\n    }\n    \n    // 自动修复策略\n    console.log('[auto-fix-exec-mlzujdem] Detected pattern, attempting fix...');\n    \n    // TODO: 根据具体错误实现修复逻辑\n    // 常见策略:\n    // 1. 重试\n    // 2. Fallback到备用方案\n    // 3. 参数调整\n    \n    return ctx;\n  }\n};\n",
        "HOOK.md": "---\nname: auto-fix-exec-mlzujdem\ndescription: 自动处理 exec 工具的 error: missing required argument '...'\n\nUsage: cla 错误\nmetadata:\n  openclaw:\n    events: [\"tool_error\"]\n    autoGenerated: true\n    patternId: pattern_exec_1771891647602\n---\n\n# auto-fix-exec-mlzujdem\n\n自动生成的错误处理Hook。\n\n## 匹配条件\n- 工具: `exec`\n- 错误: error: missing required argument '...'\n\nUsage: clawhub search [options] <query...>\n\nVector search \n- 出现次数: 13\n\n## 行为\n当检测到匹配的错误时，自动尝试修复。\n"
      }
    },
    {
      "name": "auto-fix-cron-mlzujdem",
      "dir": "/home/li/.openclaw/hooks/auto-fix-cron-mlzujdem",
      "files": {
        "handler.js": "/**\n * Auto-generated Hook: auto-fix-cron-mlzujdem\n * Pattern: gateway timeout after Nms\nGateway target: ws://N.N.N.N:N\nSource: local loopback\nConfig: /h\n * Occurrences: 11\n * Generated: 2026-02-24T00:07:27.646Z\n */\n\nmodule.exports = {\n  name: 'auto-fix-cron-mlzujdem',\n  events: ['tool_error'],\n  \n  handler: async (ctx) => {\n    const { tool, error } = ctx;\n    \n    // 检查是否匹配模式\n    if (tool !== 'cron') return ctx;\n    \n    const errorStr = String(error).toLowerCase();\n    const pattern = 'gateway timeout after nms\ngateway target: ws://n.n.n.n:n\nsource: local loopback\nconfig: /h';\n    \n    if (!errorStr.includes(pattern.slice(0, 50).toLowerCase())) {\n      return ctx;\n    }\n    \n    // 自动修复策略\n    console.log('[auto-fix-cron-mlzujdem] Detected pattern, attempting fix...');\n    \n    // TODO: 根据具体错误实现修复逻辑\n    // 常见策略:\n    // 1. 重试\n    // 2. Fallback到备用方案\n    // 3. 参数调整\n    \n    return ctx;\n  }\n};\n",
        "HOOK.md": "---\nname: auto-fix-cron-mlzujdem\ndescription: 自动处理 cron 工具的 gateway timeout after Nms\nGateway target: ws://N.N 错误\nmetadata:\n  openclaw:\n    events: [\"tool_error\"]\n    autoGenerated: true\n    patternId: pattern_cron_1771891647602\n---\n\n# auto-fix-cron-mlzujdem\n\n自动生成的错误处理Hook。\n\n## 匹配条件\n- 工具: `cron`\n- 错误: gateway timeout after Nms\nGateway target: ws://N.N.N.N:N\nSource: local loopback\nConfig: /h\n- 出现次数: 11\n\n## 行为\n当检测到匹配的错误时，自动尝试修复。\n"
      }
    }
  ],
  "skills": [],
  "skipped": [
    {
      "id": "pattern_message_1771891647602",
      "tool": "message",
      "errorPattern": "gateway closed (N): unauthorized: device token mismatch (rotate/reissue device token)\nGateway tar",
      "occurrences": 14,
      "useCount": 14,
      "resolutionRate": 0,
      "avgImprovement": 0,
      "crystallizable": true,
      "sampleError": "gateway closed (1008): unauthorized: device token mismatch (rotate/reissue device token)\nGateway target: ws://127.0.0.1:18789\nSource: local loopback\nConfig: /home/li/.openclaw/openclaw.json\nBind: loopback"
    }
  ]
}