# OpenClaw 优化系统文档

> 最后更新: 2026-02-23
> 版本: 2.0

## 📊 系统概览

经过四阶段优化，OpenClaw现在具备完整的记忆系统和24小时自进化能力。

### 优化成果

| 指标 | 优化前 | 优化后 | 提升 |
|------|--------|--------|------|
| Cron任务 | 18个 | 14个 | -22% |
| Hooks | 7个 | 15个 | +114% |
| 记忆索引 | 分散 | 三级架构 | 统一 |
| 可结晶模式 | 未识别 | 5个 | 新增 |

---

## 🧠 三级记忆架构

```
┌─────────────────────────────────────────────────────────┐
│                    L0 索引层 (<3KB)                      │
│  热点记忆 + 用户画像 + 工具健康 + 快速标签索引            │
│  文件: .unified/L0-index/index.json                      │
├─────────────────────────────────────────────────────────┤
│                    L1 结构层                             │
│  模式结晶 + 技能索引 + 验证报告                          │
│  目录: .unified/L1-structured/                           │
├─────────────────────────────────────────────────────────┤
│                    L2 原始层                             │
│  learnings.json + sessions/ + logs/                     │
│  引用: .unified/L2-raw/references.json                   │
└─────────────────────────────────────────────────────────┘
```

### 记忆服务使用

```bash
# 构建索引
node ~/.openclaw/workspace/memory/.unified/memory-unified-service.js build

# 搜索记忆
node ~/.openclaw/workspace/memory/.unified/memory-unified-service.js search "Discord"

# 深度搜索
node ~/.openclaw/workspace/memory/.unified/memory-unified-service.js search "进化" --deep
```

---

## 🔄 自进化系统

### 进化循环流程

```
感知 → 学习 → 进化 → 验证 → 决策 → 反馈
  ↓       ↓       ↓       ↓       ↓       ↓
索引    提取    结晶    测试    规划    记录
```

### 核心脚本

| 脚本 | 功能 | 频率 |
|------|------|------|
| `evolution-cycle.sh` | 完整进化循环 | 每4小时 |
| `pattern-extractor.js` | 提取失败模式 | 随进化循环 |
| `knowledge-crystallizer.js` | 结晶为hooks | 随进化循环 |
| `evolution-validator.js` | 验证结晶效果 | 随进化循环 |

### 手动触发进化

```bash
bash ~/.openclaw/workspace/scripts/evolution-cycle.sh
```

---

## ⏰ Cron任务列表

| 任务名 | 调度 | 功能 |
|--------|------|------|
| evolution-cycle | 每4小时 | 完整进化循环 |
| heartbeat-monitor | 每5分钟 | 系统健康检查 |
| foundry-evolution-v2 | 每2小时 | Foundry自进化 |
| foundry-crossbot-learning | 每6小时 | 跨Bot学习 |
| daily-memory-summary | 每天23:00 | 每日记忆总结 |
| evening-report | 每天22:00 | 晚间汇报 |
| memory-janitor | 每天3:00 | 记忆清理 |
| smart-diagnosis | 每3小时 | 智能诊断 |
| bot-discord-discussion | 每2小时 | Discord讨论 |
| arxiv-learning | 每天6:00 | 学术学习 |
| auto-proactive-check | 每小时 | 主动检查 |
| company-weekly-review | 周五18:00 | 周报 |
| weekly-deep-review | 周六18:00 | 深度复盘 |

---

## 🔗 跨实例协调

### 实例配置

| 实例 | IP | 角色 | VPN端口 |
|------|------|------|---------|
| 亮仔 | 192.168.1.5 | 主实例 | 7897 |
| 辉仔 | 192.168.1.16 | 备实例 | 7899 |

### 协调命令

```bash
# 查看完整状态
node ~/.openclaw/workspace/scripts/cross-instance-coord.js all

# 检查对端
node ~/.openclaw/workspace/scripts/cross-instance-coord.js peer

# 同步学习
node ~/.openclaw/workspace/scripts/cross-instance-coord.js sync

# 故障转移检查
node ~/.openclaw/workspace/scripts/cross-instance-coord.js failover
```

---

## 🚀 快速启动

```bash
# 系统初始化
bash ~/.openclaw/workspace/scripts/system-init.sh

# 运行进化循环
bash ~/.openclaw/workspace/scripts/evolution-cycle.sh

# 心跳检查
node ~/.openclaw/workspace/scripts/heartbeat-monitor.js
```

---

## 📁 目录结构

```
~/.openclaw/
├── cron/                    # Cron任务配置
├── foundry/                 # Foundry学习数据
│   ├── learnings.json       # 学习模式 (6939条)
│   └── metrics.json         # 工具健康度
├── hooks/                   # 自动化hooks (15个)
│   ├── web-fetch-fallback/  # Web fetch降级
│   ├── message-auto-retry/  # 消息自动重试
│   └── ...
├── skills/                  # 技能包 (33个)
├── workspace/
│   ├── memory/
│   │   ├── .unified/        # 三级记忆架构
│   │   │   ├── L0-index/    # 索引层
│   │   │   ├── L1-structured/ # 结构层
│   │   │   └── L2-raw/      # 原始层引用
│   │   └── ...
│   └── scripts/             # 系统脚本
│       ├── evolution-cycle.sh
│       ├── heartbeat-monitor.js
│       ├── cross-instance-coord.js
│       └── system-init.sh
└── openclaw.json            # 主配置
```

---

## ⚠️ 注意事项

1. **敏感信息**: Token/Key存储在`openclaw.json`，需加密处理
2. **日志清理**: 定期运行`memory-janitor`清理过期日志
3. **备份**: 优化前已备份`jobs.json.before-optimization`
4. **回滚**: 如有问题可从备份恢复

---

*Generated by OpenClaw Optimization System v2.0*
